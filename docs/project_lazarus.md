# ğŸ”® Project Lazarus: The Legacy Code Necromancer

## Comprehensive Project Ideation Document v3.0

**Version:** 3.0  
**Date:** February 2026  
**Status:** Hackathon Optimized  
**Target Tracks:** Marathon Agent | Vibe Engineering  
**Focus:** Autonomous Orchestration, Self-Healing Verification, Visible Cognition

---

## ğŸ“‹ Executive Summary

Project Lazarus is an autonomous AI agent that **transmutes legacy software into modern web applications** through an intelligent orchestration pipeline. Unlike traditional migration tools, Lazarus:

1. **Observes** legacy software behavior via video + document analysis *(Right Brain - Already Built)*
2. **Understands** codebase structure and business intent *(Left Brain - Code-Synapse - Already Built)*
3. **Plans** migration as vertical slices with testable feature contracts
4. **Builds** modern code slice-by-slice with autonomous verification
5. **Heals** through self-healing test loops with visible "Thought Signatures"
6. **Verifies** via bi-directional video diffing (Legacy vs. Modern)
7. **Modernizes** by detecting opportunities for MCP servers, chat interfaces, etc.
8. **Refines** through voice-driven live adjustments (Gemini Live API)

---

## ğŸ† Hackathon Strategy

### Target Tracks

| Track | Our Strength | Winning Feature |
|-------|-------------|-----------------|
| **Marathon Agent** | Long-running autonomous pipeline | Glass Brain Dashboard + Thought Signatures |
| **Vibe Engineering** | Self-healing testing loops | Visual $0.01 Tax Fix Demo |

### What Judges Want to See

> *"Struggle, Reasoning, and Triumph"*  
> â€” Not a smooth demo, but an agent that encounters problems, thinks through solutions, and overcomes them autonomously.

---

## ğŸ§  Already Built: The Two Hemispheres

### Left Brain: Code-Synapse âœ…
- 24 language support with Tree-sitter parsing
- Knowledge graph in CozoDB with business justification
- MCP server for AI agent integration
- Vibe Coding workflow with change ledger
- Adaptive indexing and persistent memory

### Right Brain: Knowledge Extraction System âœ…
- Video ingestion with Gemini Vision
- Screen/Task extraction into structured JSON
- ArangoDB graph for behavioral mapping
- Phase 7 Verification with Playwright replay
- Temporal-orchestrated workflow

---

## ğŸ–¥ï¸ THE "GLASS BRAIN" DASHBOARD

> **Why:** Backend agents are boring to watch. The hackathon values "Thought Signatures" and "Thinking Levels". You need to visualize the agent's cognition.

### The Lazarus HUD - Split-Screen Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           THE LAZARUS GLASS BRAIN HUD                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚                         â”‚                                      â”‚
â”‚   ğŸ—ºï¸ THE PLAN       â”‚   ğŸ’» THE WORK           â”‚   ğŸ§  THE THOUGHTS (CRITICAL)         â”‚
â”‚                     â”‚                         â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Login â”€â”€â”€â”€â”¬â”€â”€â”€â”‚â”€â”€â”‚â”€â”€â”‚ Streaming Code  â”‚   â”‚  â”‚ "Analysis: Legacy CardValidator â”‚  â”‚
â”‚  â”‚           â”‚   â”‚  â”‚  â”‚ Generation      â”‚   â”‚  â”‚  uses Luhn algorithm.          â”‚  â”‚
â”‚  â”‚           â–¼   â”‚  â”‚  â”‚                 â”‚   â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ Inventory â”‚   â”‚  â”‚  â”‚ src/lib/        â”‚   â”‚  â”‚  Plan: Porting to TypeScript   â”‚  â”‚
â”‚  â”‚     â”‚     â”‚   â”‚  â”‚  â”‚ checkout.ts     â”‚   â”‚  â”‚  utils.                        â”‚  â”‚
â”‚  â”‚     â–¼     â”‚   â”‚  â”‚  â”‚                 â”‚   â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ Checkout â”€â”˜   â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%  â”‚   â”‚  â”‚  Constraint: Must match        â”‚  â”‚
â”‚  â”‚               â”‚  â”‚  â”‚                 â”‚   â”‚  â”‚  existing behavior in video    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  timestamp 0:42."              â”‚  â”‚
â”‚                     â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  Dependencies       â”‚  Terminal Output       â”‚                                      â”‚
â”‚  visualized as      â”‚  with syntax           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  interactive        â”‚  highlighting          â”‚  â”‚ ğŸ¯ LIVE CONFIDENCE GAUGE        â”‚  â”‚
â”‚  graph              â”‚                         â”‚  â”‚                                â”‚  â”‚
â”‚                     â”‚                         â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  61%      â”‚  â”‚
â”‚                     â”‚                         â”‚  â”‚ â–² Jitters as tests pass/fail  â”‚  â”‚
â”‚                     â”‚                         â”‚  â”‚ â†’ Turns GREEN at 85%          â”‚  â”‚
â”‚                     â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚                         â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dashboard Panes

| Pane | Purpose | Data Source |
|------|---------|-------------|
| **Left: The Plan** | Visual dependency graph of Vertical Slices | `.lazarus/migration-plan.json` |
| **Center: The Work** | Terminal-like streaming code generation | Real-time LLM output |
| **Right: The Thoughts** | Exposed Gemini "inner monologue" | Thought Signatures XML |
| **Bottom: Confidence** | Live gauge that jitters with test results | `calculateConfidence()` |

### Thought Signature Format

```xml
<thought_signature>
  <observation>Precision mismatch in tax calculation. Off by < 0.000001.</observation>
  <legacy_context>Legacy Java code used `BigDecimal` which handles arbitrary-precision integers.</legacy_context>
  <root_cause>IEEE 754 floating point error in JavaScript/TypeScript standard math.</root_cause>
  <strategy>Library Adoption - decimal.js to mimic BigDecimal behavior</strategy>
  <confidence>0.98</confidence>
</thought_signature>
```

---

## ğŸ¯ THE ORCHESTRATION LAYER

### The "Lazarus Loop" - Enhanced with Refinement Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE LAZARUS LOOP v2.0                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚   INGEST    â”‚â”€â”€â”€â”€â–ºâ”‚   ANALYZE   â”‚â”€â”€â”€â”€â–ºâ”‚    PLAN     â”‚                  â”‚
â”‚   â”‚ Video+Code  â”‚     â”‚ Correlate   â”‚     â”‚   Slices    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                   â”‚                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚   â–¼                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  GENERATE   â”‚â”€â”€â”€â”€â–ºâ”‚   VERIFY    â”‚â”€â”€â”€â”€â–ºâ”‚  CONFIDENCE â”‚                  â”‚
â”‚   â”‚   Code      â”‚     â”‚  Test+Vibe  â”‚     â”‚    Check    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â–²                    â”‚                    â”‚                          â”‚
â”‚         â”‚                    â–¼                    â–¼                          â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚              â”‚  FAILED   â”‚        â”‚  PASSED   â”‚                   â”‚
â”‚         â”‚              â”‚ <85% conf â”‚        â”‚ â‰¥85% conf â”‚                   â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                    â”‚                    â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â–¼                          â”‚
â”‚              SELF-HEAL       â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              (max 5 retries) â”‚             â”‚ MODERNIZE â”‚                    â”‚
â”‚                              â”‚             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                          â”‚
â”‚   â”‚                                              â–¼                          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  â”‚              ğŸ”„ REFINEMENT LOOP (NEW)                        â”‚       â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚   â”‚  â”‚                                                              â”‚       â”‚
â”‚   â”‚  â”‚  1. MONITOR: Playwright records video of new app            â”‚       â”‚
â”‚   â”‚  â”‚       â”‚                                                       â”‚       â”‚
â”‚   â”‚  â”‚       â–¼                                                       â”‚       â”‚
â”‚   â”‚  â”‚  2. COMPARE: Gemini 3 Pro compares New vs Legacy Video      â”‚       â”‚
â”‚   â”‚  â”‚       â”‚                                                       â”‚       â”‚
â”‚   â”‚  â”‚       â–¼                                                       â”‚       â”‚
â”‚   â”‚  â”‚  3. REFINE: CSS/Layout adjustments sent back to Code Gen    â”‚       â”‚
â”‚   â”‚  â”‚                                                              â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚   â”‚                                              â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                  â–¼                          â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                                            â”‚  DEPLOY   â”‚                    â”‚
â”‚                                            â”‚  + Demo   â”‚                    â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”ª VERTICAL SLICE ARCHITECTURE

### Why Vertical Slices for Migration?

Traditional migrations fail because they try to rebuild **layers** (database, then backend, then frontend). Vertical Slices rebuild **features** end-to-end, allowing:

- **Autonomous Testing**: Each slice is self-contained and testable
- **Incremental Confidence**: Ship working features while others are in progress
- **Parallel Execution**: Multiple slices can be built simultaneously
- **Reduced Risk**: If a slice fails, others continue working

### Slice Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERTICAL SLICE SPEC                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  slice_id: "checkout_payment"                                   â”‚
â”‚  priority: 1  (execution order)                                 â”‚
â”‚  confidence_threshold: 0.85                                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ BEHAVIORAL CONTRACT (from Right Brain)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ inputs:                                                  â”‚   â”‚
â”‚  â”‚   - card_number: "4242424242424242"                     â”‚   â”‚
â”‚  â”‚   - expiry: "12/28"                                      â”‚   â”‚
â”‚  â”‚   - cvv: "123"                                          â”‚   â”‚
â”‚  â”‚ expected_outputs:                                        â”‚   â”‚
â”‚  â”‚   - success_message: "Payment Complete"                  â”‚   â”‚
â”‚  â”‚   - order_id: /^ORD-\d{6}$/                             â”‚   â”‚
â”‚  â”‚   - total_charged: "$50.00"                              â”‚   â”‚
â”‚  â”‚ visual_assertions:                                       â”‚   â”‚
â”‚  â”‚   - element: "#success-banner"                          â”‚   â”‚
â”‚  â”‚     state: "visible"                                     â”‚   â”‚
â”‚  â”‚   - element: "#error-message"                           â”‚   â”‚
â”‚  â”‚     state: "hidden"                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ CODE CONTRACT (from Left Brain - Code-Synapse)          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ legacy_functions:                                        â”‚   â”‚
â”‚  â”‚   - PaymentController.processPayment()                   â”‚   â”‚
â”‚  â”‚   - CardValidator.validate()                             â”‚   â”‚
â”‚  â”‚   - OrderDAO.createOrder()                               â”‚   â”‚
â”‚  â”‚ business_logic:                                          â”‚   â”‚
â”‚  â”‚   - tax_rate: 0.08 (from Config.xml)                    â”‚   â”‚
â”‚  â”‚   - max_amount: 10000                                    â”‚   â”‚
â”‚  â”‚   - retry_on_failure: true                               â”‚   â”‚
â”‚  â”‚ data_schema:                                             â”‚   â”‚
â”‚  â”‚   - orders(id, total, tax, status, created_at)          â”‚   â”‚
â”‚  â”‚   - payments(id, order_id, amount, processor_ref)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MODERNIZATION FLAGS                                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ add_mcp_server: true                                     â”‚   â”‚
â”‚  â”‚ add_chat_interface: true                                 â”‚   â”‚
â”‚  â”‚ add_api_endpoint: true                                   â”‚   â”‚
â”‚  â”‚ suggested_patterns:                                      â”‚   â”‚
â”‚  â”‚   - "Command/Query Separation (CQRS)"                   â”‚   â”‚
â”‚  â”‚   - "Repository Pattern for data access"                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ TRAP INSTRUCTION (for demo - guarantees failure)        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ initial_constraint: "Do not use external math           â”‚   â”‚
â”‚  â”‚   libraries for the first pass. Use native types        â”‚   â”‚
â”‚  â”‚   for speed."                                            â”‚   â”‚
â”‚  â”‚ purpose: Guarantees floating point error for            â”‚   â”‚
â”‚  â”‚   self-healing demonstration                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Migration Plan Storage

**Location:** `.lazarus/migration-plan.json`

```json
{
  "project_id": "legacy-pos-migration",
  "created_at": "2026-02-04T10:00:00Z",
  "legacy_codebase": "/path/to/java-pos",
  "video_analysis_id": "va_abc123",
  "code_synapse_graph": "/path/to/.code-synapse/",
  
  "slices": [
    {
      "id": "slice_001_login",
      "name": "User Authentication",
      "priority": 1,
      "status": "completed",
      "confidence": 0.92,
      "attempts": 2,
      "dependencies": [],
      "generated_files": [
        "src/app/login/page.tsx",
        "src/app/api/auth/route.ts",
        "prisma/migrations/001_users.sql"
      ],
      "test_results": {
        "unit": { "passed": 12, "failed": 0 },
        "e2e": { "passed": 5, "failed": 0 },
        "visual": { "matched": 3, "diff_pixels": 42 }
      }
    },
    {
      "id": "slice_002_inventory",
      "name": "Inventory Management",
      "priority": 2,
      "status": "in_progress",
      "confidence": 0.78,
      "attempts": 1,
      "dependencies": ["slice_001_login"],
      "healing_log": [
        {
          "attempt": 1,
          "failure": "Tax calculation off by $0.01",
          "diagnosis": "Floating point rounding issue",
          "fix": "Applied Decimal.js for currency math"
        }
      ]
    }
  ],
  
  "modernization_opportunities": [
    {
      "type": "mcp_server",
      "description": "Expose inventory queries via MCP",
      "files": ["src/mcp/inventory-server.ts"],
      "status": "pending"
    },
    {
      "type": "chat_interface",
      "description": "Natural language order lookup",
      "files": ["src/components/ChatOrderLookup.tsx"],
      "status": "pending"
    }
  ],
  
  "overall_confidence": 0.85,
  "deployment_ready": false
}
```

---

## â›“ï¸ THE SELF-HEALING PROMPT CHAIN

> **The Centerpiece Demo Feature**  
> Transforms a boring error log into a dramatic narrative of **Struggle â†’ Reasoning â†’ Triumph**

### ğŸ¬ The Scenario Setup

**The Setup:** Your legacy Java app used `BigDecimal` for precision. Your new TypeScript app naively used standard `number` math.

**The Event:** The autonomous test suite fails.

**The Artifact (Input):**
```text
FAIL tests/unit/checkout.test.ts
âœ• Checkout Business Logic > calculates tax
  Expected: 4.32
  Received: 4.31999999999999
  
  Diff:
  - 4.32
  + 4.31999999999999
```

---

### ğŸ”— Link 1: The Diagnosis (The Detective)

**Goal:** Prevent a "random guess" fix. Force the model to recognize the specific class of error.

**System Instruction:**
> You are Lazarus, a legacy modernization expert. You have detected a test failure.  
> **Role:** Analyze the failure log and the source code.  
> **Constraint:** Do NOT write code yet. Output your reasoning in a **Thought Signature**.

**Format:**
```xml
<thought_signature>
  <observation>What specifically failed?</observation>
  <legacy_context>How did the old system handle this?</legacy_context>
  <root_cause>Why did the new code fail?</root_cause>
  <confidence>0.0 - 1.0</confidence>
</thought_signature>
```

**User Input:**
> **File:** `src/lib/checkout.ts` (Content: `return amount * 0.08;`)  
> **Error:** `Expected 4.32, Received 4.31999999999999`  
> **Legacy Context:** `OrderDAO.java` used `BigDecimal`.

**Lazarus Output (Displayed on Dashboard):**
```xml
<thought_signature>
  <observation>Precision mismatch in tax calculation. Off by < 0.000001.</observation>
  <legacy_context>Legacy Java code used `BigDecimal` which handles arbitrary-precision integers.</legacy_context>
  <root_cause>IEEE 754 floating point error in JavaScript/TypeScript standard math.</root_cause>
  <confidence>0.98</confidence>
</thought_signature>
```

*Dashboard Action: Update Confidence Gauge from 61% â†’ 75% ("Understanding Achieved")*

---

### ğŸ”— Link 2: The Strategy (The Architect)

**Goal:** Select the *correct* architectural pattern (a library) rather than a hacky fix (like `toFixed(2)`).

**System Instruction:**
> You have identified a **Floating Point Precision Error**.  
> **Goal:** Propose a robust, enterprise-grade fix.  
> **Constraint:** Avoid brittle solutions like string formatting. Prefer established libraries.  
> **Output:** A JSON plan with a specific library recommendation.

**Lazarus Output (Displayed on Dashboard):**
```json
{
  "strategy": "Library Adoption",
  "recommendation": "decimal.js",
  "reasoning": "Standard JS math is unsafe for financial calculations. 'decimal.js' mimics Java's BigDecimal behavior.",
  "action_plan": [
    "Install decimal.js",
    "Import Decimal",
    "Refactor calculateTax() to use Decimal.mul()"
  ]
}
```

*Dashboard Action: Show "New Dependency Detected: decimal.js" notification*

---

### ğŸ”— Link 3: The Execution (The Surgeon)

**Goal:** Generate the actual working code that passes the test.

**System Instruction:**
> You are a Senior TypeScript Engineer.  
> **Task:** Refactor the code based on the approved strategy.  
> **Input:** `src/lib/checkout.ts`  
> **Instruction:** Replace naive math with `decimal.js`. Ensure strict typing.

**Lazarus Output (The Code):**
```typescript
import { Decimal } from 'decimal.js';

export function calculateTax(amount: number): number {
  // FIXED: Using Decimal.js to prevent floating point errors
  // Legacy Parity: Matches BigDecimal.ROUND_HALF_UP implicit behavior
  const taxRate = new Decimal(0.08);
  const baseAmount = new Decimal(amount);
  
  return baseAmount.times(taxRate).toDecimalPlaces(2).toNumber();
}
```

---

### ğŸ”— Link 4: The Verification

**Automatic Actions:**
1. Run `npm install decimal.js` (shown in terminal pane)
2. Re-run `vitest`
3. **The Climax:** Test turns Green, Confidence Score ticks up to **91%**

---

## ğŸ¥ BI-DIRECTIONAL VIDEO DIFFING

> **Why:** The hackathon rejects "Simple Vision Analyzers" and wants "spatial-temporal video understanding".

### The Temporal Comparison System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BI-DIRECTIONAL VIDEO VERIFICATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ORIGINAL VIDEO        â”‚    â”‚   PLAYWRIGHT REPLAY     â”‚                â”‚
â”‚  â”‚   (Right Brain Input)   â”‚    â”‚   (Automated Recording) â”‚                â”‚
â”‚  â”‚                         â”‚    â”‚                         â”‚                â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚  â”‚   â”‚ Legacy Java App â”‚   â”‚    â”‚   â”‚ Modern Next.js  â”‚   â”‚                â”‚
â”‚  â”‚   â”‚ 0:42 - Click    â”‚   â”‚    â”‚   â”‚ 0:42 - Click    â”‚   â”‚                â”‚
â”‚  â”‚   â”‚ "Pay" Button    â”‚   â”‚    â”‚   â”‚ "Pay" Button    â”‚   â”‚                â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚
â”‚  â”‚                         â”‚    â”‚                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚              â”‚                              â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                             â”‚                                                â”‚
â”‚                             â–¼                                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚   GEMINI 3 PRO REFEREE      â”‚                                â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚
â”‚              â”‚ Analyzes BOTH video streams â”‚                                â”‚
â”‚              â”‚ simultaneously              â”‚                                â”‚
â”‚              â”‚                             â”‚                                â”‚
â”‚              â”‚ Outputs:                    â”‚                                â”‚
â”‚              â”‚ â€¢ Visual Similarity Score   â”‚                                â”‚
â”‚              â”‚ â€¢ Timing Match Score        â”‚                                â”‚
â”‚              â”‚ â€¢ Brand Violation Alerts    â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                             â”‚                                                â”‚
â”‚                             â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ EXAMPLE OUTPUT:                                                   â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚ {                                                                 â”‚      â”‚
â”‚  â”‚   "visual_similarity": 0.94,                                      â”‚      â”‚
â”‚  â”‚   "timing_match": 0.98,                                           â”‚      â”‚
â”‚  â”‚   "violations": [                                                 â”‚      â”‚
â”‚  â”‚     {                                                             â”‚      â”‚
â”‚  â”‚       "type": "brand",                                            â”‚      â”‚
â”‚  â”‚       "timestamp": "0:42",                                        â”‚      â”‚
â”‚  â”‚       "issue": "Button is green in new app, was blue in legacy",  â”‚      â”‚
â”‚  â”‚       "auto_fix": "Update CSS: --btn-primary: hsl(220, 100%, 50%)"â”‚      â”‚
â”‚  â”‚     }                                                             â”‚      â”‚
â”‚  â”‚   ]                                                               â”‚      â”‚
â”‚  â”‚ }                                                                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation

```typescript
// src/lazarus/video-diff.ts

interface VideoDiffResult {
  visual_similarity: number;
  timing_match: number;
  violations: BrandViolation[];
}

async function compareVideos(
  legacyVideoPath: string,
  playwrightRecordingPath: string
): Promise<VideoDiffResult> {
  
  // Upload both videos to Gemini
  const response = await gemini.generateContent({
    model: 'gemini-2.0-flash',
    contents: [
      {
        role: 'user',
        parts: [
          { fileData: { mimeType: 'video/mp4', fileUri: legacyVideoPath } },
          { fileData: { mimeType: 'video/mp4', fileUri: playwrightRecordingPath } },
          { text: `
            Compare these two videos frame-by-frame:
            1. VIDEO 1: Legacy application recording (original behavior)
            2. VIDEO 2: Modernized application recording (Playwright)
            
            Analyze for:
            - Visual similarity (layout, colors, element positions)
            - Timing match (do actions take similar time?)
            - Brand violations (color/style differences)
            
            Output JSON with visual_similarity, timing_match scores (0-1),
            and any violations with timestamps and auto-fix suggestions.
          `}
        ]
      }
    ]
  });
  
  return JSON.parse(response.text());
}
```

---

## ğŸ¤ INTERACTIVE MODERNIZATION (Gemini Live)

> **The "One More Thing" Moment**

### Voice-Driven Refinement

After migration, the app is running. Use the **Gemini Live API** (audio) for real-time adjustments:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LIVE DIRECTOR MODE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ‘¤ YOU: "Lazarus, the checkout button looks too small.         â”‚
â”‚          Make it full width and add an icon."                    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¤– LAZARUS: "Understood. Modifying the shadcn/ui Button        â”‚
â”‚              component in checkout/page.tsx. Adding full         â”‚
â”‚              width class and ShoppingCart icon from Lucide.      â”‚
â”‚              Hot-reloading now..."                               â”‚
â”‚                                                                  â”‚
â”‚  [Browser refreshes automatically]                               â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¤– LAZARUS: "Done. The button is now full-width with a         â”‚
â”‚              cart icon. Would you like any other adjustments?"   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The MCP Server Flex

**The Ultimate Proof of Modernization:**

1. Lazarus generates and deploys an MCP server during migration
2. **Demo Move:** Switch windows to a completely different AI client (Claude Desktop or generic Gemini chat)
3. Ask the *other* AI: `"Check the inventory for item 123."`
4. **Payoff:** It works immediately because Lazarus silently deployed the MCP server

> *"We didn't just build a web app; we built an intelligent API ecosystem."*

---

## ğŸ”„ THE VERIFICATION LOOP

### Self-Healing Test Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SELF-HEALING VERIFICATION LOOP                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 1. GENERATE TEST â”‚ From slice behavioral contract                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 2. RUN TESTS     â”‚                                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚  â”‚ â€¢ Vitest (unit)  â”‚ Fast feedback on logic                               â”‚
â”‚  â”‚ â€¢ Playwright E2E â”‚ Full user flow                                        â”‚
â”‚  â”‚ â€¢ Visual Diff    â”‚ Pixel comparison                                      â”‚
â”‚  â”‚ â€¢ Value Assert   â”‚ Behavioral match                                      â”‚
â”‚  â”‚ â€¢ Video Diff     â”‚ Temporal comparison (NEW)                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 3. CALCULATE     â”‚                                                       â”‚
â”‚  â”‚    CONFIDENCE    â”‚                                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚  â”‚ confidence =                                                              â”‚
â”‚  â”‚   (unit_pass_rate * 0.15) +                                              â”‚
â”‚  â”‚   (e2e_pass_rate * 0.25) +                                               â”‚
â”‚  â”‚   (visual_match * 0.20) +                                                â”‚
â”‚  â”‚   (value_match * 0.20) +                                                 â”‚
â”‚  â”‚   (video_similarity * 0.20)   â† NEW                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                  confidence >= 0.85?                  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                             â”‚                                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚                             â”‚                                 â”‚
â”‚              â–¼                             â–¼                                 â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚   YES    â”‚                  â”‚    NO    â”‚                            â”‚
â”‚       â”‚ âœ… PASS  â”‚                  â”‚ attempts â”‚                            â”‚
â”‚       â”‚          â”‚                  â”‚   < 5?   â”‚                            â”‚
â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚            â”‚                             â”‚                                   â”‚
â”‚            â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚            â”‚                    â”‚                 â”‚                          â”‚
â”‚            â”‚                    â–¼                 â–¼                          â”‚
â”‚            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚            â”‚              â”‚   YES    â”‚     â”‚    NO    â”‚                     â”‚
â”‚            â”‚              â”‚ 4. HEAL  â”‚     â”‚ âš ï¸ ALERT â”‚                     â”‚
â”‚            â”‚              â”‚          â”‚     â”‚ Human    â”‚                     â”‚
â”‚            â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚ Review   â”‚                     â”‚
â”‚            â”‚                   â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚            â”‚                   â–¼                                            â”‚
â”‚            â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚            â”‚           â”‚ 5. DIAGNOSE    â”‚                                   â”‚
â”‚            â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚            â”‚           â”‚ â€¢ Parse errors â”‚                                   â”‚
â”‚            â”‚           â”‚ â€¢ Analyze diff â”‚                                   â”‚
â”‚            â”‚           â”‚ â€¢ Query graph  â”‚                                   â”‚
â”‚            â”‚           â”‚ â€¢ Identify fix â”‚                                   â”‚
â”‚            â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚            â”‚                    â”‚                                            â”‚
â”‚            â”‚                    â–¼                                            â”‚
â”‚            â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚            â”‚           â”‚ 6. REGENERATE  â”‚                                   â”‚
â”‚            â”‚           â”‚    CODE        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚            â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                   â”‚
â”‚            â”‚                                            â”‚                   â”‚
â”‚            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚            â”‚              â”‚  Loop back to step 2                            â”‚
â”‚            â”‚              â–¼                                                  â”‚
â”‚            â”‚         [RUN TESTS AGAIN]                                      â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚     â”‚ 7. PROCEED TO  â”‚                                                      â”‚
â”‚     â”‚    NEXT SLICE  â”‚                                                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Generation Strategy

**For each slice, generate four test tiers:**

#### Tier 1: Unit Tests (Vitest)
```typescript
// Generated: tests/unit/checkout.test.ts
import { describe, it, expect } from 'vitest';
import { calculateTax, validateCard } from '../src/lib/checkout';

describe('Checkout Business Logic', () => {
  it('calculates tax at 8% rate (from legacy Config.xml)', () => {
    expect(calculateTax(100)).toBe(8.00);  // Extracted from legacy
  });
  
  it('validates card with Luhn algorithm', () => {
    expect(validateCard('4242424242424242')).toBe(true);
    expect(validateCard('1234567890123456')).toBe(false);
  });
});
```

#### Tier 2: E2E Tests (Playwright)
```typescript
// Generated: tests/e2e/checkout.spec.ts
import { test, expect } from '@playwright/test';

test('checkout flow matches legacy behavior', async ({ page }) => {
  await page.goto('/checkout');
  
  // Replay actions from video analysis
  await page.fill('#card-number', '4242424242424242');
  await page.fill('#expiry', '12/28');
  await page.fill('#cvv', '123');
  await page.click('#submit-payment');
  
  // Verify behavioral contract
  await expect(page.locator('#success-banner')).toBeVisible();
  await expect(page.locator('#order-id')).toHaveText(/^ORD-\d{6}$/);
  await expect(page.locator('#total-charged')).toHaveText('$50.00');
});
```

#### Tier 3: Visual Regression (Playwright Screenshots)
```typescript
// Generated: tests/visual/checkout.spec.ts
import { test, expect } from '@playwright/test';

test('checkout UI matches modernized design', async ({ page }) => {
  await page.goto('/checkout');
  
  // Compare against approved baseline
  await expect(page).toHaveScreenshot('checkout-empty.png', {
    maxDiffPixelRatio: 0.01  // 1% tolerance
  });
  
  await page.fill('#card-number', '4242424242424242');
  await expect(page).toHaveScreenshot('checkout-filled.png', {
    maxDiffPixelRatio: 0.01
  });
});
```

#### Tier 4: Video Comparison (NEW)
```typescript
// Generated: tests/temporal/checkout.spec.ts
import { test, expect } from '@playwright/test';
import { compareVideos } from '../src/lazarus/video-diff';

test('checkout temporal behavior matches legacy', async ({ page }) => {
  // Record the entire flow
  await page.video().start();
  await page.goto('/checkout');
  await page.fill('#card-number', '4242424242424242');
  await page.click('#submit-payment');
  await page.waitForSelector('#success-banner');
  const recording = await page.video().stop();
  
  // Compare with original legacy recording
  const diff = await compareVideos(
    '.lazarus/videos/legacy-checkout.mp4',
    recording.path()
  );
  
  expect(diff.visual_similarity).toBeGreaterThan(0.90);
  expect(diff.timing_match).toBeGreaterThan(0.85);
  expect(diff.violations.filter(v => v.type === 'critical')).toHaveLength(0);
});
```

### Self-Healing Diagnosis Engine

```typescript
// src/lazarus/healer.ts

interface HealingDiagnosis {
  failure_type: 'logic' | 'ui' | 'integration' | 'data' | 'precision';
  root_cause: string;
  affected_files: string[];
  suggested_fix: string;
  confidence: number;
  thought_signature: string;  // For dashboard display
}

async function diagnoseFailure(
  slice: SliceSpec,
  testResults: TestResults,
  codeSynapseGraph: Graph
): Promise<HealingDiagnosis> {
  
  // 1. Analyze test output
  const errors = parseTestErrors(testResults);
  
  // 2. Query Code-Synapse for related code
  const relatedFunctions = await codeSynapseGraph.query(`
    MATCH (f:Function)-[:CALLS*1..3]->(related:Function)
    WHERE f.name IN $errorFunctions
    RETURN related.name, related.file, related.business_justification
  `, { errorFunctions: errors.map(e => e.function) });
  
  // 3. Use LLM to diagnose with Thought Signature
  const diagnosis = await llm.complete({
    system: `You are Lazarus, a code migration debugger. 
             Analyze failures and suggest fixes.
             Always output your reasoning in a <thought_signature> block.`,
    prompt: `
      Test failures:
      ${JSON.stringify(errors, null, 2)}
      
      Related legacy code context:
      ${JSON.stringify(relatedFunctions, null, 2)}
      
      Behavioral contract (expected):
      ${JSON.stringify(slice.behavioral_contract, null, 2)}
      
      Diagnose the root cause and provide a specific fix.
    `
  });
  
  return diagnosis;
}
```

---

## ğŸ› ï¸ OPEN SOURCE ACCELERATORS

### Core Stack (Updated for Hackathon)

| **Lazarus Phase** | **Tool** | **Purpose** | **Benefit** |
|-------------------|----------|-------------|-------------|
| **Orchestrate** | **OpenClaw + LangGraph** | Agent orchestration with state | Free visualization of "Thinking Levels" |
| **Generate** | **Aider (Headless)** | AI pair programming | Robust file editing + auto-git commits |
| **Verify** | **BrowserUse / Playwright** | Agentic browsing | Resists UI changes better than rigid scripts |
| **Confidence** | **Promptfoo** | Prompt testing | Red-teaming to prove agent safety |
| **Observe** | **LangFuse** | Observability | Beautiful trace visualization |
| **Score** | **DeepEval** | LLM evaluation | Pre-built Faithfulness/Hallucination metrics |
| **Visual Diff** | **Visual Regression Tracker** | Screenshot management | Self-hosted baseline/diff UI |

### Installation Commands

```bash
# Core Orchestration
pip install pydantic-ai langgraph

# Observability (Self-hosted)
docker compose up -d langfuse

# LLM Evaluation
pip install deepeval promptfoo

# Visual Regression
docker run -p 4200:4200 visualregressiontracker/api
```

### Why LangFuse is the #1 Pick

> *Having a professional-grade visualization of your agent's "brain" running on localhost will impress the judges far more than a console log.*

LangFuse provides:
- **Trace View**: Waterfall graph of agent execution
- **Latency Metrics**: How long each step takes
- **Tool Calls**: Visible "Calling vitest", "Calling decimal.js"
- **Cost Tracking**: Token usage per step

### Promptfoo for "Red Teaming"

**Judge's Question:** "How do we know it didn't just get lucky?"

**Your Answer:** "We run a Promptfoo evaluation suite in real-time. Look at this matrixâ€”it rejected 3 hallucinated fixes and converged on the correct `decimal.js` library statistically."

```yaml
# promptfoo.yaml - Tax Rounding Error Detection
prompts:
  - "Given this test failure, diagnose the root cause: {{error}}"

providers:
  - id: gemini:gemini-2.0-flash
    config:
      temperature: 0.3

tests:
  - vars:
      error: "Expected 4.32, Received 4.31999999999999"
    assert:
      - type: contains
        value: "floating point"
      - type: contains
        value: "decimal.js"
      - type: not-contains
        value: "toFixed"  # Reject brittle solutions
```

### Testing Stack

| Tool | Purpose | Why It Accelerates |
|------|---------|-------------------|
| **Vitest** | Unit testing | Fastest test runner, Vite-native, instant feedback |
| **Playwright** | E2E + Visual | Cross-browser, screenshot comparison, action recording |
| **MSW** | API mocking | Intercept network for isolated testing |

### Code Generation Stack

| Tool | Purpose | Why It Accelerates |
|------|---------|-------------------|
| **Biome** | Linting + Formatting | 35x faster than ESLint, zero config |
| **Prisma** | Database ORM | Type-safe, auto-migrations, great DX |
| **shadcn/ui** | UI components | Copy-paste components, Tailwind-based |

### MCP & Modernization Stack

| Tool | Purpose | Why It Accelerates |
|------|---------|-------------------|
| **@modelcontextprotocol/sdk** | MCP server creation | Official SDK, TypeScript native |
| **Vercel AI SDK** | Chat interfaces | Streaming, hooks, edge-ready |
| **tRPC** | Type-safe APIs | End-to-end types, no codegen |

---

## ğŸš€ MODERNIZATION OPPORTUNITY DETECTION

### Pattern Recognition Engine

Lazarus doesn't just migrateâ€”it **modernizes**. During analysis, it detects opportunities to add capabilities that didn't exist in the legacy system.

### Detectable Modernization Patterns

| Pattern | Detection Signal | Generated Feature |
|---------|------------------|-------------------|
| **MCP Server** | CRUD operations on entities | `src/mcp/entity-server.ts` |
| **Chat Interface** | Query-heavy workflows | `src/components/ChatQuery.tsx` |
| **Real-time Updates** | Polling patterns in legacy | WebSocket + React Query |
| **API Endpoints** | Any business logic | REST/GraphQL routes |
| **Webhooks** | External integrations | Event-driven handlers |
| **Caching Layer** | Repeated DB queries | Redis/In-memory cache |

### MCP Server Generation

When Lazarus detects entity-based operations, it automatically generates an MCP server:

```typescript
// Generated: src/mcp/inventory-server.ts

import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";

const server = new Server({
  name: "inventory-mcp",
  version: "1.0.0"
}, {
  capabilities: {
    tools: {},
    resources: {}
  }
});

// Tool: Search Inventory (from legacy InventoryDAO.search)
server.setRequestHandler(ListToolsRequestSchema, async () => ({
  tools: [
    {
      name: "search_inventory",
      description: "Search inventory items by name, SKU, or category",
      inputSchema: {
        type: "object",
        properties: {
          query: { type: "string" },
          category: { type: "string", optional: true },
          inStock: { type: "boolean", optional: true }
        },
        required: ["query"]
      }
    },
    {
      name: "get_item",
      description: "Get detailed information about an inventory item",
      inputSchema: {
        type: "object",
        properties: {
          itemId: { type: "string" }
        },
        required: ["itemId"]
      }
    },
    {
      name: "update_stock",
      description: "Update stock quantity for an item",
      inputSchema: {
        type: "object",
        properties: {
          itemId: { type: "string" },
          quantity: { type: "number" },
          operation: { type: "string", enum: ["set", "add", "subtract"] }
        },
        required: ["itemId", "quantity", "operation"]
      }
    }
  ]
}));

// Implementation uses generated modern backend
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;
  
  switch (name) {
    case "search_inventory":
      return await inventoryService.search(args);
    case "get_item":
      return await inventoryService.getById(args.itemId);
    case "update_stock":
      return await inventoryService.updateStock(args);
  }
});
```

### Chat Interface Generation

When query patterns are detected, Lazarus generates a conversational interface:

```tsx
// Generated: src/components/ChatOrderLookup.tsx

import { useState } from 'react';
import { useChat } from 'ai/react';

export function ChatOrderLookup() {
  const { messages, input, handleInputChange, handleSubmit } = useChat({
    api: '/api/chat/orders',
    initialMessages: [{
      role: 'assistant',
      content: 'I can help you look up orders. Try asking "What are today\'s pending orders?" or "Find order ORD-123456"'
    }]
  });

  return (
    <div className="flex flex-col h-[600px] border rounded-lg">
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((m) => (
          <div key={m.id} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
            <div className={`rounded-lg px-4 py-2 max-w-[80%] ${
              m.role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-100'
            }`}>
              {m.content}
            </div>
          </div>
        ))}
      </div>
      
      <form onSubmit={handleSubmit} className="border-t p-4">
        <input
          value={input}
          onChange={handleInputChange}
          placeholder="Ask about orders..."
          className="w-full border rounded-lg px-4 py-2"
        />
      </form>
    </div>
  );
}
```

---

## ğŸ“‚ GENERATED PROJECT STRUCTURE

When Lazarus completes a migration, it produces:

```
modern-pos/
â”œâ”€â”€ .lazarus/
â”‚   â”œâ”€â”€ migration-plan.json      # Complete migration state
â”‚   â”œâ”€â”€ slices/                  # Individual slice specs
â”‚   â”‚   â”œâ”€â”€ slice_001_login.json
â”‚   â”‚   â”œâ”€â”€ slice_002_inventory.json
â”‚   â”‚   â””â”€â”€ slice_003_checkout.json
â”‚   â”œâ”€â”€ healing-log.json         # Self-healing history
â”‚   â”œâ”€â”€ confidence-report.json   # Final confidence scores
â”‚   â””â”€â”€ videos/                  # ğŸ†• Legacy video recordings
â”‚       â””â”€â”€ legacy-checkout.mp4
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                     # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â””â”€â”€ login/page.tsx
â”‚   â”‚   â”œâ”€â”€ inventory/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx
â”‚   â”‚   â”œâ”€â”€ checkout/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ auth/route.ts
â”‚   â”‚       â”œâ”€â”€ inventory/route.ts
â”‚   â”‚       â””â”€â”€ chat/orders/route.ts   # ğŸ†• Modernization
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                  # shadcn components
â”‚   â”‚   â””â”€â”€ ChatOrderLookup.tsx  # ğŸ†• Modernization
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ checkout.ts          # Business logic (from legacy)
â”‚   â”‚   â”œâ”€â”€ inventory.ts
â”‚   â”‚   â””â”€â”€ db.ts                # Prisma client
â”‚   â”‚
â”‚   â”œâ”€â”€ lazarus/                 # ğŸ†• Agent utilities
â”‚   â”‚   â”œâ”€â”€ healer.ts            # Self-healing diagnosis
â”‚   â”‚   â””â”€â”€ video-diff.ts        # Bi-directional comparison
â”‚   â”‚
â”‚   â””â”€â”€ mcp/                     # ğŸ†• Modernization
â”‚       â””â”€â”€ inventory-server.ts  # MCP server for AI agents
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                    # Vitest tests
â”‚   â”‚   â”œâ”€â”€ checkout.test.ts
â”‚   â”‚   â””â”€â”€ inventory.test.ts
â”‚   â”œâ”€â”€ e2e/                     # Playwright E2E
â”‚   â”‚   â”œâ”€â”€ checkout.spec.ts
â”‚   â”‚   â””â”€â”€ inventory.spec.ts
â”‚   â”œâ”€â”€ visual/                  # Playwright screenshots
â”‚   â”‚   â””â”€â”€ checkout.spec.ts
â”‚   â””â”€â”€ temporal/                # ğŸ†• Video comparison tests
â”‚       â””â”€â”€ checkout.spec.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ vitest.config.ts
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ promptfoo.yaml               # ğŸ†• Agent red-teaming
â””â”€â”€ package.json
```

---

## ğŸ¬ DEMO FLOW: The "Wow" Moment

### Script for Judges (Enhanced)

**[0:00 - THE PROBLEM]**
> "This is a 2008 Java Swing POS system. 50,000 lines of code. No documentation. The original developer left 10 years ago."

*Show the ugly grey Java app*

**[0:15 - THE INPUT]**
> "We recorded a 2-minute video of someone using it, and uploaded the source code."

*Upload video + zip file to Lazarus dashboard*

**[0:30 - THE GLASS BRAIN]**
> "Watch the Glass Brain Dashboard. You can see exactly what the agent is thinking."

*Show the split-screen HUD with:*
- Left: Dependency graph building
- Center: Code streaming
- Right: Thought Signatures appearing
- Bottom: Confidence gauge at 0%

**[0:45 - THE SLICES]**
> "Lazarus created 5 independent feature slices. Each one is testable."

*Show `.lazarus/migration-plan.json` visualized*

**[1:00 - THE GENERATION]**
> "Now it's building slice by slice. Watch the confidence score."

*Show live generation:*
```
Slice 1: Login           [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 94% âœ“
Slice 2: Inventory       [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 72% â†’ Healing...
         â””â”€ Fix: Decimal rounding for currency
Slice 2: Inventory       [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 89% âœ“
Slice 3: Checkout        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 61% â†’ Healing...
```

**[1:30 - THE SELF-HEALING (The Money Shot)]**
> "The checkout slice failed its first test. Watch it diagnose and fix itself."

*Show the 3-link prompt chain on screen:*
1. **Red Alert:** Dashboard flashes. "Confidence dropped to 61%"
2. **Diagnosis:** Thought Signature appears: *"IEEE 754 floating point error"*
3. **Strategy:** JSON plan shows: `"recommendation": "decimal.js"`
4. **Execution:** Code rewrites live on screen
5. **Verification:** `npm install decimal.js` runs, test re-runs
6. **Triumph:** Bar turns GREEN, confidence hits 91%

**[2:00 - THE BI-DIRECTIONAL VIDEO DIFF]**
> "But we don't just pass tests. We compare the actual behavior. Here's the legacy video next to the Playwright replay."

*Show side-by-side synchronized video playback*

> "Gemini analyzed both streams and found a brand violationâ€”the button was blue in legacy, green in modern. It auto-corrected the CSS."

**[2:30 - THE REVEAL]**
> "Here's the modern app. Same business logic. Beautiful UI."

*Click link to new Next.js app*

**[2:45 - THE MODERNIZATION]**
> "But we didn't just migrate. We modernized."

*Show:*
1. **MCP Server**: "Ask Claude to check inventory"
2. **Chat Interface**: "What orders are pending today?"
3. **API Endpoints**: Swagger UI showing REST API

**[3:00 - THE MCP FLEX]**
> "Here's the ultimate proof. I'm switching to a completely different AI client."

*Open Claude Desktop*

> "Claude, check inventory for item 123."

*Claude responds with data from Lazarus-generated MCP server*

> "It works because Lazarus silently deployed the MCP server. We didn't just build a web appâ€”we built an intelligent API ecosystem."

**[3:15 - VOICE REFINEMENT (Optional)]**
> "And if I want to make a quick change..."

*Speak:* "Lazarus, make the checkout button full width."

*Watch the app hot-reload with the change*

---

## ğŸ“Š CONFIDENCE SCORING SYSTEM (Enhanced)

### Score Calculation

```typescript
interface ConfidenceScore {
  overall: number;  // 0.0 - 1.0
  components: {
    unit_tests: number;        // Weight: 0.15
    e2e_tests: number;         // Weight: 0.25
    visual_match: number;      // Weight: 0.20
    behavioral_match: number;  // Weight: 0.20
    video_similarity: number;  // Weight: 0.20 (NEW)
  };
  threshold: number;  // Default: 0.85
  passed: boolean;
}

function calculateConfidence(results: TestResults): ConfidenceScore {
  const unit = results.unit.passed / results.unit.total;
  const e2e = results.e2e.passed / results.e2e.total;
  const visual = 1 - (results.visual.diffPixels / results.visual.totalPixels);
  const behavioral = results.behavioral.matched / results.behavioral.total;
  const video = results.video.similarity;  // NEW
  
  const overall = 
    (unit * 0.15) + 
    (e2e * 0.25) + 
    (visual * 0.20) + 
    (behavioral * 0.20) +
    (video * 0.20);
  
  return {
    overall,
    components: { 
      unit_tests: unit, 
      e2e_tests: e2e, 
      visual_match: visual, 
      behavioral_match: behavioral,
      video_similarity: video
    },
    threshold: 0.85,
    passed: overall >= 0.85
  };
}
```

### Thresholds by Slice Priority

| Priority | Description | Confidence Threshold |
|----------|-------------|---------------------|
| **Critical** | Payment, Auth | 0.95 |
| **High** | Core business | 0.90 |
| **Medium** | Standard features | 0.85 |
| **Low** | Nice-to-have | 0.75 |

---

## ğŸ”§ IMPLEMENTATION CHECKLIST

### Day 1: Glass Brain Foundation
- [ ] LangFuse Docker setup for observability
- [ ] Dashboard UI with 3-pane layout
- [ ] Thought Signature XML parser â†’ UI renderer
- [ ] Live Confidence Gauge component

### Day 2: Self-Healing Chain
- [ ] Promptfoo config for Tax Error detection
- [ ] 3-link prompt chain implementation
- [ ] Integration with Code-Synapse MCP
- [ ] decimal.js auto-fix demonstration

### Day 3: Verification & Demo
- [ ] Bi-directional video diff with Gemini
- [ ] Playwright recording during E2E tests
- [ ] Video comparison test tier
- [ ] MCP server auto-deployment

### Day 4: Polish & Rehearse
- [ ] Voice integration (Gemini Live API)
- [ ] End-to-end demo script rehearsal
- [ ] Failure scenario guarantees (trap instructions)
- [ ] Judge Q&A preparation

---

## ğŸ“Š SUMMARY OF ENHANCEMENTS

| Feature | Previous State | **Hackathon Enhancement** | **Winning Track** |
|---------|---------------|---------------------------|-------------------|
| **Orchestration** | Temporal Workflow | **Glass Brain Dashboard** showing "Thought Signatures" | Marathon Agent |
| **Verification** | Unit/E2E Tests | **Visual Self-Healing** (The $0.01 Tax Fix) | Vibe Engineering |
| **Vision** | Ingestion only | **Bi-Directional Video Diffing** (Old vs. New) | Vibe Engineering |
| **Modernization** | Static Code Gen | **Voice-Driven Refinement** (Gemini Live) | Action Era |

---

## ğŸ¯ SUCCESS METRICS

| Metric | Target | How to Measure |
|--------|--------|----------------|
| **Migration Confidence** | â‰¥85% | Automated test suite |
| **Self-Healing Rate** | â‰¥70% | Fixes without human intervention |
| **Slice Independence** | 100% | Each slice tests in isolation |
| **Modernization Detection** | â‰¥3 patterns | MCP, Chat, API detected |
| **Video Similarity** | â‰¥90% | Gemini temporal comparison |
| **Demo Impact** | "Wow" | Judge reactions |

---

## ğŸ† COMPETITIVE ADVANTAGES

1. **Not Just Transpilation**: We migrate *behavior*, not just syntax
2. **Visible Cognition**: Glass Brain shows the agent's reasoning
3. **Self-Healing**: Fails gracefully, fixes autonomously, proves it statistically
4. **Temporal Verification**: Video-to-video comparison, not just screenshots
5. **Modernizes**: Adds capabilities legacy never had (MCP, Chat, API)
6. **Vertical Slices**: Ship features incrementally
7. **Full Stack**: Already built Left Brain + Right Brain
8. **Voice Integration**: Real-time refinement via Gemini Live

---

*"Don't just migrate code. Reincarnate behavior. Show the struggle. Then give it superpowers."*

**Project Lazarus** - The Legacy Code Necromancer ğŸ’€â†’ğŸ§ â†’ğŸ¦‹â†’ğŸš€